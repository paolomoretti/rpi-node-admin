// Generated by CoffeeScript 1.6.3
var Admin, Home, Iframe, Main, Webcam;

Admin = angular.module("Admin", ["ngRoute"]);

Admin.config([
  "$routeProvider", function($routeProvider) {
    $routeProvider.when("/", {
      templateUrl: "/assets/templates/home.html",
      controller: "Home"
    });
    $routeProvider.when("/webcam/", {
      templateUrl: "/assets/templates/webcam.html",
      controller: "Webcam"
    });
    return $routeProvider.when("/redirect/:page", {
      templateUrl: "/assets/templates/iframe.html",
      controller: "Iframe"
    });
  }
]);

Main = function($scope) {};

Home = function($scope) {
  return console.log("Scope", $scope);
};

Iframe = function($scope, $routeParams, $sce) {
  $scope.iframeUrl = "about:blank";
  $("iframe").height($(window).height() - $("iframe").offset().top - 10);
  switch ($routeParams.page) {
    case "transmission":
      return $scope.iframeUrl = $sce.trustAsResourceUrl("http://bitter.kicks-ass.org:9091");
    case "xbmc":
      return $scope.iframeUrl = $sce.trustAsResourceUrl("http://192.168.0.13:9090");
    case "router":
      return $scope.iframeUrl = $sce.trustAsResourceUrl("http://bitter.kicks-ass.org:8080");
  }
};

Webcam = function($scope, $http, $timeout) {
  $scope.webcamSrc = "http://bitter.kicks-ass.org:9999/webcam/webcam.jpeg?timestamp=1432423";
  $scope.actionLabel = "Start webcam";
  $scope.started = false;
  $scope.executing = false;
  $scope.freq = 1;
  $scope.toggleWebcam = function() {
    $scope.executing = true;
    if ($scope.started === false) {
      return $http.get("/webcam/start").success(function(res) {
        return $scope.started = res === "ok";
      });
    } else {
      return $http.get("/webcam/stop").success(function(res) {
        return $scope.started = false;
      });
    }
  };
  return $scope.$watch("started", function(newVal) {
    $scope.actionLabel = newVal === true ? "Stop webcam" : "Start webcam";
    $scope.executing = false;
    if (newVal === true) {
      return $scope.intId = setInterval(function() {
        return $timeout((function() {
          return $scope.webcamSrc = $scope.webcamSrc.split("timestamp=")[0] + Date.now();
        }), 0);
      }, $scope.freq * 1000);
    } else {
      return clearInterval($scope.intId);
    }
  });
};
